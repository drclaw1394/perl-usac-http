@{[
  init {
    use Data::Dumper;
    use uSAC::HTTP;
    use uSAC::HTTP::Middleware::Form;
    # Render login screen
    output location=>"login", inline=>1;
    inherit "parent.plt";
  }
  ]}
@{[fill_slot header=>"Time: ".time]}


@{[fill_slot footer=>"Dynamic login"]}
<h1> logo goes here </h1>
<form action="/login" method="POST">
  <label for="username">Username</label>
  <input name="username">

  <label for="password">Password</label>
  <input name="password" type="password">

  <input name="target" hidden value="/home">
  <input name="protection_token" hidden value="@{[$token=generate_protection_token '/home']}">
  <input type="submit">
</form>
$token;
@{[

pl { 
  ##################################################################################
  # for($fields{out_header}{HTTP_SET_COOKIE()}){                                   #
  #       $_//=[];                                                                 #
  #       use HTTP::State::Cookie ":all";                                          #
  #       push $_->@*, encode_set_cookie cookie_struct "protection_token"=>$token; #
  # }                                                                              #
  ##################################################################################
}

]}

@{[ do {
"Rex method is: <pre>", $fields{rex}[METHOD], "</pre>"
}]}

